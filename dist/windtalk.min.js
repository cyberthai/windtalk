var windtalk=function(a){"use strict";function b(a,c){return c=c||[],new Proxy(function(){},{get(d,e,f){if("then"===e){if(0===c.length)return{then:()=>f};const b=a.post({type:"GET",path:c});return b.then.bind(b)}return b(a,c.concat(e))},set(b,d,e){return a.post({type:"SET",path:c.concat(d),value:e})},apply(b,d,e){return a.post({type:"APPLY",path:c,args:e})}})}function c(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}class d{constructor(a){this.w=a,this.uid=`${Date.now()}-${c()}`,this.c=0,this.cbs={},self.addEventListener("message",a=>{const b=a.data&&a.data.windtalk&&a.data.id,c=b&&this.cbs[b];c&&(delete this.cbs[b],a.data.error?c[1](new Error(a.data.error)):c[0](a.data.value))})}post(a){const b=a.args||[],c=`${this.uid}-${++this.c}`;return new Promise((d,e)=>{this.cbs[c]=[d,e],this.w.postMessage(Object.assign({},a,{id:c,args:b,target:this.uid,windtalk:!0}),"*")})}}return a.link=function(a){return b(new d(a))},a.expose=function(a,b){const c=b||window.top;self.addEventListener("message",async b=>{if(b.data&&b.data.id&&b.data.type&&b.data.windtalk){const d=b.data;d.path=d.path||[];const e=d.id,f=b=>b.reduce((a,b)=>a?a[b]:a,a),g={id:e,windtalk:!0},h=f(d.path),i=f(d.path.slice(0,-1));switch(d.type){case"GET":g.value=h;break;case"SET":const a=d.path.length&&d.path[d.path.length-1];a&&(i[a]=d.value),g.value=!!a;break;case"APPLY":try{g.value=await h.apply(i,d.args||[])}catch(a){g.error=a.toString()}}c.postMessage(g,"*")}})},a}({});