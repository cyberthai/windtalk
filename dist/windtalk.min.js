var windtalk=function(a){"use strict";function b(a,c){return c=c||[],new Proxy(function(){},{get(d,e,f){if("then"===e){if(0===c.length)return{then:()=>f};const b=a.post({type:"GET",path:c});return b.then.bind(b)}return b(a,c.concat(e))},set(b,d,e){return a.post({type:"SET",path:c.concat(d),value:e})},apply(b,d,e){return a.post({type:"APPLY",path:c,args:e})}})}function c(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}class d{constructor(a){this.w=a,this.uid=`${Date.now()}-${c()}`,this.c=0,this.cbs={},self.addEventListener("message",a=>{const b=a.data&&a.data.id,c=b&&this.cbs[b];c&&(delete this.cbs[b],a.data.error?c[1](new Error(a.data.error)):c[0](a.data.value))})}post(a){const b=a.args||[],c=`${this.uid}-${++this.c}`;return new Promise((d,e)=>{this.cbs[c]=[d,e],this.w.postMessage(Object.assign({},a,{id:c,args:b,target:this.uid}),"*")})}}return a.link=function(a){return b(new d(a))},a.expose=function(a,b){const c=b||window.top;self.addEventListener("message",async b=>{const d=b.data||{};d.path=d.path||[];const e=b=>b.reduce((a,b)=>a?a[b]:a,a),f=d.id;if(f&&d.type){const a={id:f},b=e(d.path),g=e(d.path.slice(0,-1));switch(d.type){case"GET":a.value=b;break;case"SET":const c=d.path.length&&d.path[d.path.length-1];c&&(g[c]=d.value),a.value=!!c;break;case"APPLY":try{a.value=await b.apply(g,d.args||[])}catch(b){a.error=b.toString()}}c.postMessage(a,"*")}})},a}({});