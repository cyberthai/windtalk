(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.windtalk={})})(this,function(a){"use strict";function b(a,b){return b=b||[],new Proxy(function(){},{get(c,d,e){if("then"===d){if(0===b.length)return{then:()=>e};const c=a.post({type:"GET",path:b});return c.then.bind(c)}return _proxy(a,b.concat(d))},set(c,d,e){return a.post({type:"SET",path:b.concat(d),value:e})},apply(c,d,e){return a.post({type:"APPLY",path:b,args:e})}})}function c(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}class d{constructor(a){this.w=a,this.uid=`${Date.now()}-${c()}`,this.c=0,this.cbs={},a.addEventListener("message",a=>{const b=a.data&&a.data.id,c=b&&this.cbs[b];c&&(delete this.cbs[b],a.data.error?c[1](new Error(a.data.error)):c[0](a.data.value))})}post(a){const b=a.args||[],c=`${this.uid}-${++this.c}`;return new Promise((d,e)=>{this.cbs[c]=[d,e],this.w.postMessage(Object.assign({},a,{id:c,args:b,target:this.uid}),"*")})}}a.link=function(a){return b(new d(a))},a.expose=function(a,b){const c=b||self;c.addEventListener("message",async b=>{const d=b.data||{};d.path=d.path||[];const e=b=>b.reduce((a,b)=>a?a[b]:a,a),f=d.id;if(f&&d.type){const a={id:f},b=e(d.path),g=e(d.path.slice(0,-1));switch(d.type){case"GET":a.value=b;break;case"SET":const c=d.path.length&&d.path[d.path.length-1];c&&(g[c]=d.value),a.value=!!c;break;case"APPLY":try{a.value=await b.apply(g,d.args||[])}catch(b){a.error=b.toString()}}c.postMessage(a,"*")}})},Object.defineProperty(a,"__esModule",{value:!0})});