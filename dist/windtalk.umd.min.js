(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.windtalk={})})(this,function(a){"use strict";async function b(a){const b=a.data;let c,d,e;if(c=b&&b.id)if((d=b.type)&&f){b.path=b.path||[];const e={id:c},f=i(b.path),g=i(b.path.slice(0,-1));switch(d){case"G":e.value=f;break;case"S":const a=b.path.length&&b.path.pop();a&&(g[a]=b.value);break;case"A":try{e.value=await f.apply(g,b.args||[])}catch(a){e.error=a.toString()}}a.source.postMessage(e,"*")}else(e=h[c])&&(delete h[c],b.error?e[1](new Error(b.error)):e[0](b.value))}function d(){g||(self.addEventListener("message",b),g=!0)}function c(a){const b=`${Date.now()}-${Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}`;let e=0;return d(),c=>{const d=c.args||[],f=`${b}-${++e}`;return new Promise((b,e)=>{h[f]=[b,e],a.postMessage(Object.assign({},c,{id:f,args:d}),"*")})}}function e(a,b){return b=b||[],new Proxy(function(){},{get(c,d,f){if("then"===d){if(0===b.length)return{then:()=>f};const c=a({type:"G",path:b});return c.then.bind(c)}return e(a,b.concat(d))},set(c,d,e){return a({type:"S",path:b.concat(d),value:e})},apply(c,d,e){return a({type:"A",path:b,args:e})}})}let f,g;const h={},i=a=>a.reduce((a,b)=>a?a[b]:a,f);a.link=function(a){return e(c(a))},a.expose=function(a){f=a,d()},Object.defineProperty(a,"__esModule",{value:!0})});
