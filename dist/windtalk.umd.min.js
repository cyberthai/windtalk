(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.windtalk={})})(this,function(a){"use strict";async function b(a){const b=a.data;let c,d,e;if(c=b&&b.id)if((d=b.type)&&g&&f){b.path=b.path||[];const a={id:c},e=j(b.path),f=j(b.path.slice(0,-1));switch(d){case"GET":a.value=e;break;case"SET":const c=b.path.length&&b.path[b.path.length-1];c&&(f[c]=b.value);break;case"APPLY":try{a.value=await e.apply(f,b.args||[])}catch(b){a.error=b.toString()}}g.postMessage(a,"*")}else h&&(e=h[c])&&(delete h[c],b.error?e[1](new Error(b.error)):e[0](b.value))}function d(){i||(self.addEventListener("message",b),i=!0)}function c(a){const b=`${Date.now()}-${Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}`;let e=0;return d(),c=>{const d=c.args||[],f=`${b}-${++e}`;return new Promise((b,e)=>{h[f]=[b,e],a.postMessage(Object.assign({},c,{id:f,args:d}),"*")})}}function e(a,b){return b=b||[],new Proxy(function(){},{get(c,d,f){if("then"===d){if(0===b.length)return{then:()=>f};const c=a({type:"GET",path:b});return c.then.bind(c)}return e(a,b.concat(d))},set(c,d,e){return a({type:"SET",path:b.concat(d),value:e})},apply(c,d,e){return a({type:"APPLY",path:b,args:e})}})}let f,g,h,i;const j=a=>a.reduce((a,b)=>a?a[b]:a,f);a.link=function(a){return h={},e(c(a))},a.expose=function(a,b){g=b||window.top,f=a,d()},Object.defineProperty(a,"__esModule",{value:!0})});